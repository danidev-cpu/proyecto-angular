<div class="container mt-5 mb-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0">Gestión de platos</h2>
        <button type="button" class="btn btn-outline-light" (click)="startCreate()">
            Nuevo plato
        </button>
    </div>

    @if (requestError) {
    <div class="alert alert-danger" role="alert">{{ requestError }}</div>
    }

    <div class="card bg-dark text-white border-light p-4 mb-4">
        <h5 class="mb-3">{{ editingDishId ? 'Editar plato' : 'Crear plato' }}</h5>

        <form [formGroup]="formGroup" (ngSubmit)="saveDish()">
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="name" class="form-label">Nombre*</label>
                    <input id="name" type="text" class="form-control" formControlName="name" maxlength="50" />
                </div>

                <div class="col-md-6 mb-3">
                    <label for="price" class="form-label">Precio*</label>
                    <input id="price" type="number" class="form-control" formControlName="price" min="0.01"
                        step="0.01" />
                </div>

                <div class="col-12 mb-3">
                    <label for="description" class="form-label">Descripción*</label>
                    <textarea id="description" class="form-control" formControlName="description"
                        maxlength="200"></textarea>
                </div>

                <div class="col-md-6 mb-3">
                    <label for="category" class="form-label">Categoría*</label>
                    <select id="category" class="form-select" formControlName="category">
                        @for (category of categoryOptions; track category.value) {
                        <option [value]="category.value">{{ category.label }}</option>
                        }
                    </select>
                </div>

                <div class="col-md-6 mb-3">
                    <label for="image" class="form-label">URL imagen</label>
                    <input id="image" type="text" class="form-control" formControlName="image" />
                </div>
            </div>

            <div class="d-flex gap-2">
                <button class="btn btn-outline-light" type="submit">
                    {{ editingDishId ? 'Guardar cambios' : 'Crear plato' }}
                </button>
                @if (editingDishId) {
                <button class="btn btn-secondary" type="button" (click)="startCreate()">Cancelar edición</button>
                }
            </div>
        </form>
    </div>

    <div class="row">
        @for (dish of dishes$ | async; track dish.id) {
        <div class="col-md-6 mb-4">
            <div class="card bg-dark text-white border-light h-100">
                <img [src]="dish.image || 'assets/placeholder.jpg'" class="card-img-top dish-image" [alt]="dish.name" />
                <div class="card-body d-flex flex-column">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h5 class="mb-0">{{ dish.name }}</h5>
                        <span class="badge" [ngClass]="dish.enabled ? 'bg-success' : 'bg-secondary'">
                            {{ dish.enabled ? 'Habilitado' : 'Deshabilitado' }}
                        </span>
                    </div>
                    <p class="text-secondary small mb-2">{{ dish.description }}</p>
                    <p class="mb-1">Categoría: {{ dish.category }}</p>
                    <p class="mb-3">Precio: {{ dish.price | currency:'EUR' }}</p>

                    <div class="mt-auto d-flex gap-2 flex-wrap">
                        <button class="btn btn-outline-light btn-sm" type="button" (click)="startEdit(dish)">
                            Editar
                        </button>
                        <button class="btn btn-outline-warning btn-sm" type="button" (click)="toggleDishEnabled(dish)">
                            {{ dish.enabled ? 'Deshabilitar' : 'Habilitar' }}
                        </button>
                        <button class="btn btn-outline-danger btn-sm" type="button" (click)="deleteDish(dish.id)">
                            Eliminar
                        </button>
                    </div>
                </div>
            </div>
        </div>
        } @empty {
        <p class="text-secondary">No hay platos registrados.</p>
        }
    </div>
</div>